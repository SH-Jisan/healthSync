-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.ai_health_plans (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid NOT NULL UNIQUE,
  diet_plan text,
  exercise_plan text,
  lifestyle_tips text,
  created_at timestamp with time zone DEFAULT timezone('utc'::text, now()),
  CONSTRAINT ai_health_plans_pkey PRIMARY KEY (id),
  CONSTRAINT ai_health_plans_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.appointments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid,
  doctor_id uuid,
  hospital_id uuid,
  test_id uuid,
  appointment_date timestamp without time zone,
  status text DEFAULT 'PENDING'::text,
  created_at timestamp without time zone DEFAULT now(),
  reason text,
  CONSTRAINT appointments_pkey PRIMARY KEY (id),
  CONSTRAINT appointments_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES public.profiles(id),
  CONSTRAINT appointments_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES public.profiles(id),
  CONSTRAINT appointments_hospital_id_fkey FOREIGN KEY (hospital_id) REFERENCES public.profiles(id),
  CONSTRAINT appointments_test_id_fkey FOREIGN KEY (test_id) REFERENCES public.available_tests(id)
);
CREATE TABLE public.available_tests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  category text,
  base_price numeric,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT available_tests_pkey PRIMARY KEY (id)
);
CREATE TABLE public.blood_donors (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  last_donation_date date,
  availability boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT blood_donors_pkey PRIMARY KEY (id),
  CONSTRAINT blood_donors_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.blood_requests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  requester_id uuid NOT NULL,
  blood_group text NOT NULL,
  hospital_name text NOT NULL,
  urgency text DEFAULT 'NORMAL'::text,
  reason text,
  status text DEFAULT 'OPEN'::text,
  accepted_count integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT blood_requests_pkey PRIMARY KEY (id),
  CONSTRAINT blood_requests_requester_id_fkey FOREIGN KEY (requester_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.diagnostic_patients (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  diagnostic_id uuid NOT NULL,
  patient_id uuid NOT NULL,
  assigned_at timestamp without time zone DEFAULT now(),
  CONSTRAINT diagnostic_patients_pkey PRIMARY KEY (id),
  CONSTRAINT diagnostic_patients_diagnostic_id_fkey FOREIGN KEY (diagnostic_id) REFERENCES public.profiles(id),
  CONSTRAINT diagnostic_patients_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.doctor_hospitals (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  doctor_id uuid,
  hospital_name text NOT NULL,
  designation text,
  visiting_hours text,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT doctor_hospitals_pkey PRIMARY KEY (id),
  CONSTRAINT doctor_hospitals_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.doctor_patients (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  doctor_id uuid,
  patient_id uuid,
  assigned_at timestamp without time zone DEFAULT now(),
  CONSTRAINT doctor_patients_pkey PRIMARY KEY (id),
  CONSTRAINT doctor_patients_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES public.profiles(id),
  CONSTRAINT doctor_patients_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.health_metrics (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid NOT NULL,
  date date DEFAULT CURRENT_DATE,
  weight numeric,
  height numeric,
  water_intake integer DEFAULT 0,
  sleep_hours numeric DEFAULT 0,
  bmi numeric,
  CONSTRAINT health_metrics_pkey PRIMARY KEY (id),
  CONSTRAINT health_metrics_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.hospital_doctors (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  hospital_id uuid,
  doctor_id uuid,
  joined_at timestamp without time zone DEFAULT now(),
  visiting_hours text,
  is_active boolean DEFAULT true,
  CONSTRAINT hospital_doctors_pkey PRIMARY KEY (id),
  CONSTRAINT hospital_doctors_hospital_id_fkey FOREIGN KEY (hospital_id) REFERENCES public.profiles(id),
  CONSTRAINT hospital_doctors_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.hospital_inventory (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  hospital_id uuid NOT NULL,
  blood_group text NOT NULL,
  quantity integer DEFAULT 0,
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT hospital_inventory_pkey PRIMARY KEY (id),
  CONSTRAINT hospital_inventory_hospital_id_fkey FOREIGN KEY (hospital_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.medical_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid NOT NULL,
  uploader_id uuid,
  title text NOT NULL,
  event_type text DEFAULT 'REPORT'::text,
  event_date date DEFAULT CURRENT_DATE,
  severity text DEFAULT 'LOW'::text,
  summary text,
  extracted_text text,
  key_findings ARRAY,
  attachment_urls ARRAY,
  ai_details jsonb,
  created_at timestamp with time zone DEFAULT now(),
  file_hash text,
  performed_by_doctor_id uuid,
  performed_at_hospital_id uuid,
  medicines jsonb,
  CONSTRAINT medical_events_pkey PRIMARY KEY (id),
  CONSTRAINT medical_events_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES public.profiles(id),
  CONSTRAINT medical_events_uploader_id_fkey FOREIGN KEY (uploader_id) REFERENCES public.profiles(id),
  CONSTRAINT medical_events_performed_by_doctor_id_fkey FOREIGN KEY (performed_by_doctor_id) REFERENCES public.profiles(id),
  CONSTRAINT medical_events_performed_at_hospital_id_fkey FOREIGN KEY (performed_at_hospital_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.patient_payments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid,
  provider_id uuid,
  test_names ARRAY,
  total_amount numeric DEFAULT 0,
  paid_amount numeric DEFAULT 0,
  status text DEFAULT 'PAID'::text,
  created_at timestamp without time zone DEFAULT now(),
  report_status text DEFAULT 'PENDING'::text,
  CONSTRAINT patient_payments_pkey PRIMARY KEY (id),
  CONSTRAINT patient_payments_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES public.profiles(id),
  CONSTRAINT patient_payments_provider_id_fkey FOREIGN KEY (provider_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  full_name text,
  role text DEFAULT 'CITIZEN'::text,
  email text,
  phone text,
  avatar_url text,
  blood_group text,
  dob date,
  gender text,
  specialty text,
  address text,
  district text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  is_donor boolean DEFAULT false,
  last_donation_date date,
  fcm_token text,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);
CREATE TABLE public.request_acceptors (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  request_id uuid,
  donor_id uuid,
  accepted_at timestamp with time zone DEFAULT now(),
  CONSTRAINT request_acceptors_pkey PRIMARY KEY (id),
  CONSTRAINT request_acceptors_request_id_fkey FOREIGN KEY (request_id) REFERENCES public.blood_requests(id),
  CONSTRAINT request_acceptors_donor_id_fkey FOREIGN KEY (donor_id) REFERENCES public.profiles(id)
);